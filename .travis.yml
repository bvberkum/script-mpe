sudo: false

addons:
  apt:
    packages:
      - tree
      - realpath
      - uuid-runtime
      - moreutils
      - curl
      - php5-cli
# not allowed:
# - rhash
# - pytz

install:
  - pip install --upgrade --user -r requirements.txt
  - pip install --upgrade --user -r test-requirements.txt
  - npm install parse-torrent lodash
  - "source ./install-dependencies.sh && install_bats"
  - "source ./install-dependencies.sh && install_mkdoc"
  - "source ./install-dependencies.sh && install_pylib"
  - "source ./install-dependencies.sh && install_script"
  - "source ./install-dependencies.sh && install_docopt"
  - pip install --user nose-parameterized
  - mkdir -vp ~/.local/{bin,lib,share}
  - 'curl -sS https://getcomposer.org/installer | php -- --install-dir=$HOME/.local/bin --filename=composer'
  - ~/.local/bin/composer --version
  - composer install
  - touch $HOME/.basename-reg.yaml

before_script:
  - echo "before script"
  - whoami
  - hostname
  - box version && box -V
  - vc.sh help
  - radical.py --help
  - jsotk.py -h
  - htd help
  - ~/.local/bin/composer --version
  - ./bin/behat --version

script:
- . ./tools/ci/build.sh

env:
  global:
    - CS=dark
    - TRAVIS_SKIP=1
    - TEST_ENV=travis
    - UCONFDIR=$HOME/etc
    - PATH=$PATH:$HOME/bin:$HOME/usr/bin:$HOME/.local/bin/
    - PYTHONPATH=$PYTHONPATH:$HOME/bin:$HOME/lib/py
    - Build_Deps_Default_Paths=1
  matrix:
  - ENV= 
#- ENV=testing
#- ENV=production

branches:
  not: []
  #only:
    #  - master
    #  - '/^test.*$/'
    #  - '/^dev.*$/'
    #  - '/^[0-9]*\.[0-9]*\.[0-9]*/'

#deploy:
#  provider: releases
#  api_key: $GH_ACCESS_TOKEN
#  file: script-mpe-$TRAVIS_TAG.tar
#  on:
#    repo: dotmpe/script.mpe
#    tags: true
#    condition: $ENV = production
#
#


